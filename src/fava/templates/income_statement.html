{% import '_tree_table.html' as tree_table with context %}

{% set root_tree = g.filtered.root_tree %}
{% set options = ledger.options %}
{% set invert = ledger.fava_options.invert_income_liabilities_equity %}
{% set incomesAverage =  incomes_expenses_averages[0]%}
{% set expensesAverage =  incomes_expenses_averages[1]%}

<svelte-component type="charts"><script type="application/json">{{
  [
    chart_api.interval_totals(g.interval, (options['name_income'], options['name_expenses']), label=_('Net Profit'), invert=invert),
    chart_api.interval_totals(g.interval, options['name_income'], label='{} ({})'.format(_('Income'), g.interval.label), invert=invert),
    chart_api.interval_totals(g.interval, options['name_expenses'], label='{} ({})'.format(_('Expenses'), g.interval.label)),
    chart_api.hierarchy(options['name_income']),
    chart_api.hierarchy(options['name_expenses']),
  ]|tojson
}}</script></svelte-component>

<div class="row">
  <div class="column">
    <div class="inc_exp_avg_header">Incomes Average</div>
    {% for inc_average in incomes_expenses_averages[0] %}
    <div class="inc_exp_avg_row">
      <div class="inc_exp_avg_column">
        {{inc_average}}
      </div>
      <div class="inc_exp_avg_column">
        {{incomesAverage[inc_average] | format_currency}}
      </div>
    </div>
    {% endfor %}
  </div>
  <div class="column">
    <div class="inc_exp_avg_header">Expenses Average</div>
    {% for exp_average in incomes_expenses_averages[1] %}
    <div class="inc_exp_avg_row">
      <div class="inc_exp_avg_column">
        {{exp_average}}
      </div>
      <div class="inc_exp_avg_column">
        {{expensesAverage[exp_average] | format_currency}}
      </div>
    </div>
    {% endfor %}
  </div>
</div>

<div class="row">
  <div class="column">
    {{ tree_table.tree(root_tree.get(options['name_income']), invert=invert) }}
  </div>
  <div class="column">
    {{ tree_table.tree(root_tree.get(options['name_expenses'])) }}
  </div>
  <div class="column">
    {{ tree_table.tree(root_tree.net_profit(options, _('Net Profit')), invert=invert) }}
  </div>
</div>
